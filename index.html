<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RDHS Trincomalee - Vehicle Management System</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9fafb;
      color: #333;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #005f73;
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 1.4rem;
    }
    main {
      padding: 20px;
      max-width: 1000px;
      margin: auto;
    }
    input[type="text"] {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      margin-bottom: 25px;
    }
    th, td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: #0a9396;
      color: white;
    }
    tr:hover {
      background-color: #e0fbfc;
      cursor: pointer;
    }
    .tab-buttons {
      display: flex;
      justify-content: space-around;
      margin-bottom: 20px;
    }
    .tab-buttons button {
      padding: 10px 20px;
      border: none;
      background-color: #94d2bd;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }
    .tab-buttons button.active {
      background-color: #0a9396;
      color: white;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <header>ðŸš— RDHS Trincomalee Vehicle Management System</header>
  <main>
    <div class="tab-buttons">
      <button id="vehicleTab" class="active">Vehicle Master</button>
      <button id="expenditureTab">Expenditure View</button>
    </div>

    <section id="vehicleSection">
      <input type="text" id="searchBox" placeholder="Search by Vehicle Number...">
      <table id="vehicleTable">
        <thead id="vehicleHead"></thead>
        <tbody id="vehicleBody"></tbody>
      </table>
    </section>

    <section id="expenditureSection" class="hidden">
      <h2 id="selectedVehicleTitle">Expenditures</h2>
      <table id="expenditureTable">
        <thead id="expHead"></thead>
        <tbody id="expBody"></tbody>
      </table>
    </section>
  </main>

  <script>
    const apiUrl = 'https://script.google.com/macros/s/AKfycbwkMxUJv5slT2-GtCNzvOc_FPS8uyDv6nU8twkPGGUlVmct21TdXaOvn7EkuvL5EeMZ/exec';
    let vehicles = [];
    let expenditures = [];

    const vehicleTab = document.getElementById('vehicleTab');
    const expenditureTab = document.getElementById('expenditureTab');
    const vehicleSection = document.getElementById('vehicleSection');
    const expenditureSection = document.getElementById('expenditureSection');
    const searchBox = document.getElementById('searchBox');
    const selectedVehicleTitle = document.getElementById('selectedVehicleTitle');

    vehicleTab.addEventListener('click', () => {
      vehicleTab.classList.add('active');
      expenditureTab.classList.remove('active');
      vehicleSection.classList.remove('hidden');
      expenditureSection.classList.add('hidden');
    });

    expenditureTab.addEventListener('click', () => {
      expenditureTab.classList.add('active');
      vehicleTab.classList.remove('active');
      vehicleSection.classList.add('hidden');
      expenditureSection.classList.remove('hidden');
    });

    async function loadData() {
      try {
        const response = await fetch(apiUrl);
        const data = await response.json();

        vehicles = data.Vehicle_Master || [];
        expenditures = data.Expenditures || [];

        renderVehicleTable(vehicles);
      } catch (err) {
        console.error('Error loading data:', err);
      }
    }

    function renderVehicleTable(data) {
      const tableHead = document.getElementById('vehicleHead');
      const tableBody = document.getElementById('vehicleBody');
      tableHead.innerHTML = '';
      tableBody.innerHTML = '';

      if (data.length === 0) return;

      const headers = Object.keys(data[0]);
      const headRow = document.createElement('tr');
      headers.forEach(h => {
        const th = document.createElement('th');
        th.textContent = h;
        headRow.appendChild(th);
      });
      tableHead.appendChild(headRow);

      data.forEach(row => {
        const tr = document.createElement('tr');
        tr.addEventListener('click', () => showExpenditures(row.Vehicle_Number));
        headers.forEach(h => {
          const td = document.createElement('td');
          td.textContent = row[h];
          tr.appendChild(td);
        });
        tableBody.appendChild(tr);
      });
    }

    function showExpenditures(vehicleNumber) {
      const expTableHead = document.getElementById('expHead');
      const expTableBody = document.getElementById('expBody');
      expTableHead.innerHTML = '';
      expTableBody.innerHTML = '';
      selectedVehicleTitle.textContent = `Expenditures for Vehicle: ${vehicleNumber}`;

      const filtered = expenditures.filter(e => e.Vehicle_Number === vehicleNumber);
      if (filtered.length === 0) {
        expTableBody.innerHTML = '<tr><td colspan="5">No expenditure records found.</td></tr>';
      } else {
        const headers = Object.keys(filtered[0]);
        const headRow = document.createElement('tr');
        headers.forEach(h => {
          const th = document.createElement('th');
          th.textContent = h;
          headRow.appendChild(th);
        });
        expTableHead.appendChild(headRow);

        filtered.forEach(row => {
          const tr = document.createElement('tr');
          headers.forEach(h => {
            const td = document.createElement('td');
            td.textContent = row[h];
            tr.appendChild(td);
          });
          expTableBody.appendChild(tr);
        });
      }

      expenditureTab.classList.add('active');
      vehicleTab.classList.remove('active');
      vehicleSection.classList.add('hidden');
      expenditureSection.classList.remove('hidden');
    }

    searchBox.addEventListener('input', e => {
      const term = e.target.value.toLowerCase();
      const filtered = vehicles.filter(v => v.Vehicle_Number.toLowerCase().includes(term));
      renderVehicleTable(filtered);
    });

    loadData();
  </script>
</body>
</html>
